#!/usr/bin/env python
"""Generate protocols_data.go from protocols.csv"""

import sys

header = """// generated by protocols.py -- DO NOT EDIT
// run make generate to refresh

package datasets
var protocolNameToNumber = map[string]uint8 {"""

footer = """}"""


def canon(name):
	name = name.lower()
	name = name.replace(' ', '')
	name = name.replace('-', '')
	name = name.replace('_', '')
	name = name.replace('.', '')
	name = name.replace('/', '')
	return name


def generate_protocols_dot_go(csv_filename, out_filename):
	with open(out_filename, 'w') as outfp:
		print >>outfp, header
		names = set()
		with open(csv_filename, 'r') as infp:
			for line in infp:
				line = line.strip()
				if not line or line.startswith('#'):
					continue
				num, _, name = line.partition(',')

				name = canon(name)
				if name in names:
					raise Exception("Duplicate name: %s" % name)
				names.add(name)
				print >>outfp, '"%s": %d,' % (name, int(num))
		print >>outfp, footer


if __name__ == '__main__':
	generate_protocols_dot_go(sys.argv[1], sys.argv[2])
